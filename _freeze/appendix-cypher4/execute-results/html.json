{
  "hash": "db84d550c71aeafdcc493b3a92320fa5",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Count Queries\"\nlightbox:\n  match: auto\n  effect: fade\n  desc-position: bottom\n  loop: false\n---\n\n\n\n\nThis page contains a selection of count queries that are used to explore the graph database. The queries are designed to provide insights into the data and relationships between nodes. The queries can be run in a Neo4j browser or other Cypher-compatible interface.\n\n### Count all nodes - by label\n\n```cypher\n// Count of nodes - row per node\n\nUNWIND [\"student\", \"staff\", \"room\", \"activity\"] AS label\nMATCH (n)\nWHERE label IN labels(n)\nRETURN label, count(n) AS count\n```\n![Count All Nodes](./images/cypher-node-count1.png)\n\n```cypher\n// Count of nodes - single row\n\nMATCH (n:student)\nWITH count(n) AS studentCount\nMATCH (n:staff)\nWITH studentCount, count(n) AS lecturerCount\nMATCH (n:room)\nWITH studentCount, lecturerCount, count(n) AS roomCount\nMATCH (n:activity)\nRETURN studentCount, lecturerCount, roomCount, count(n) AS activityCount\n```\n![Count All Nodes](./images/cypher-node-count2.png)\n\n\n### Count all relationships - by type\n\n```cypher\n// Count of relationships\n\nMATCH ()-[r:ATTENDS]->()\nWITH count(r) AS attendsCount\nMATCH ()-[r:TEACHES]->()\nWITH attendsCount, count(r) AS teachesCount\nMATCH ()-[r:OCCUPIES]->() \nWITH attendsCount, teachesCount, count(r) AS occupiesCount\nMATCH ()-[r:BELONGS_TO]->()\nRETURN attendsCount, teachesCount, occupiesCount, count(r) AS belongsCount\n```\n![Count All Relationships](./images/cypher-rel-count.png)\n\n\n### Activity counts\n\n```cypher\n// Count of activities\n\nMATCH (a:activity)\nRETURN count(a) AS totalActivities;\n```\n\n```cypher\n// Count of activities on a day\n\nMATCH (a:activity)\nWHERE a.actDayName = \"Wednesday\"\nRETURN DISTINCT count(a) AS wednesdayActivities\n```\n\n```cypher\n\nMATCH (a:activity)\nRETURN DISTINCT a.actDayName AS dayName, count(a) AS activityCount\n```\n\n![](./images/cypher-act-count.png){.gallery-image group=\"cypher-act\"}\n\n![](./images/cypher-act-day-count.png){.gallery-image group=\"cypher-act\"}\n\n![](./images/cypher-act-days-count.png){.gallery-image group=\"cypher-act\"}\n\n### Activity counts by time\n\n* Query run via Python\n\n::: {#71ce86b1 .cell execution_count=1}\n``` {.python .cell-code}\nfrom connect_to_neo4j_db import connect_to_neo4j\nfrom neo4j import GraphDatabase\n\n# connect to Neo4j\ndriver = connect_to_neo4j()\n\n# session\nsession = driver.session()\n\n# run query\nquery = \"\"\"\n// Activity count by time (start)\n\nMATCH (a:activity)\nWHERE a.actStartTime = localtime(\"17:00:00\")\n//AND a.actDayName = \"Wednesday\"\nRETURN count(a) AS activitiesStartingAt5pm\n\"\"\"\nprint(\"Running query...\\n\")\nresult = session.run(query)\nfor record in result:\n    print(record)\n\n# close the session and driver\nsession.close()\ndriver.close()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nConnecting to Neo4j database....\nConnected to Neo4j database successfully! Driver: <neo4j._sync.driver.Neo4jDriver object at 0x0000024C33367F10>\nRunning query...\n\n<Record activitiesStartingAt5pm=172>\n```\n:::\n:::\n\n\n### Staff activity count\n\n* Query run via Python\n* First 5 records as Pandas DataFrame\n\n::: {#ff966fdc .cell execution_count=2}\n``` {.python .cell-code}\nfrom connect_to_neo4j_db import connect_to_neo4j\nfrom neo4j import GraphDatabase\nimport pandas as pd\n\n# connect to Neo4j\ndriver = connect_to_neo4j()\n\n# session\nsession = driver.session()\n\n# run query\nquery = \"\"\"\n// Staff activity count\n\nMATCH (st:staff)-[r:TEACHES]->(a:activity)\nRETURN st.staffFullName_anon AS staffName, count(a) AS activityCount\nORDER BY activityCount DESC\n\"\"\"\nprint(\"Running query...\\n\")\nresult = session.run(query)\n\n# list to hold records\nrecords = []\nfor record in result:\n    records.append(record)\n\n# df of first 5 records\ndf = pd.DataFrame(records[:5], columns=[\"staffName\", \"activityCount\"])\n\n# print\nprint(df)\n\n# close the session and driver\nsession.close()\ndriver.close()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nConnecting to Neo4j database....\nConnected to Neo4j database successfully! Driver: <neo4j._sync.driver.Neo4jDriver object at 0x0000024C33399F10>\nRunning query...\n\n        staffName  activityCount\n0  Debbie Nichols            145\n1  Marc Hernandez            127\n2    Eileen Allen            126\n3    Steven Perez            124\n4  Justin Alvarez            112\n```\n:::\n:::\n\n\n",
    "supporting": [
      "appendix-cypher4_files"
    ],
    "filters": [],
    "includes": {}
  }
}